<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LenovoTuner Pro ‚Äî Centro de Optimizaci√≥n Integral</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;500;600;700;800;900&display=swap');

        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0e1a;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .code-font { font-family: 'JetBrains Mono', monospace; }

        /* Animated background */
        .bg-grid {
            background-image: 
                linear-gradient(rgba(59,130,246,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59,130,246,0.03) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* Sidebar */
        .sidebar {
            background: linear-gradient(180deg, #0f1629 0%, #0a0e1a 100%);
            border-right: 1px solid rgba(59,130,246,0.15);
            width: 280px;
            transition: transform 0.3s ease;
        }
        .sidebar-item {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        .sidebar-item:hover {
            background: rgba(59,130,246,0.08);
            border-left-color: rgba(59,130,246,0.3);
        }
        .sidebar-item.active {
            background: rgba(59,130,246,0.12);
            border-left-color: #3b82f6;
            color: #60a5fa;
        }

        /* Cards */
        .opt-card {
            background: linear-gradient(135deg, rgba(15,23,42,0.9), rgba(30,41,59,0.6));
            border: 1px solid rgba(59,130,246,0.1);
            transition: all 0.3s ease;
        }
        .opt-card:hover {
            border-color: rgba(59,130,246,0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(59,130,246,0.1);
        }
        .opt-card.selected {
            border-color: rgba(59,130,246,0.5);
            background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(30,58,138,0.2));
        }

        /* Toggle */
        .toggle { position: relative; width: 44px; height: 24px; }
        .toggle input { display: none; }
        .toggle-track {
            position: absolute; inset: 0;
            background: #334155;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .toggle input:checked + .toggle-track { background: #3b82f6; }
        .toggle-knob {
            position: absolute; top: 2px; left: 2px;
            width: 20px; height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        .toggle input:checked ~ .toggle-knob { left: 22px; }

        /* Keybind input */
        .keybind-input {
            background: rgba(15,23,42,0.8);
            border: 1px solid rgba(59,130,246,0.2);
            transition: all 0.2s ease;
            cursor: pointer;
            min-width: 120px;
            text-align: center;
        }
        .keybind-input:focus, .keybind-input.recording {
            border-color: #f59e0b;
            box-shadow: 0 0 15px rgba(245,158,11,0.3);
            outline: none;
        }

        /* Slider */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: #334155;
            border-radius: 3px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px; height: 18px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(59,130,246,0.5);
        }

        /* Select */
        .custom-select {
            background: rgba(15,23,42,0.8);
            border: 1px solid rgba(59,130,246,0.2);
            color: #e2e8f0;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2360a5fa' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        /* Tabs */
        .tab-btn.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 0 15px rgba(59,130,246,0.3);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #1e3a5f; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #3b82f6; }

        /* Export modal */
        .modal-overlay {
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
        }

        /* Glow effects */
        .glow-blue { box-shadow: 0 0 30px rgba(59,130,246,0.2); }
        .glow-green { box-shadow: 0 0 20px rgba(34,197,94,0.2); }
        .glow-amber { box-shadow: 0 0 20px rgba(245,158,11,0.2); }

        /* Pulse */
        @keyframes pulse-dot { 0%,100%{ opacity:1; } 50%{ opacity:0.4; } }
        .pulse-dot { animation: pulse-dot 2s infinite; }

        /* Stats counter */
        .stat-card {
            background: linear-gradient(135deg, rgba(15,23,42,0.8), rgba(30,41,59,0.4));
            border: 1px solid rgba(59,130,246,0.1);
        }

        /* Mobile sidebar */
        @media (max-width: 1024px) {
            .sidebar { 
                position: fixed; 
                z-index: 50; 
                height: 100vh;
                transform: translateX(-100%); 
            }
            .sidebar.open { transform: translateX(0); }
        }

        /* Profile badge */
        .profile-badge {
            background: linear-gradient(135deg, #1e3a5f, #172554);
            border: 1px solid rgba(59,130,246,0.2);
        }

        pre { white-space: pre-wrap; word-wrap: break-word; }

        /* Color picker */
        input[type="color"] {
            -webkit-appearance: none;
            border: 2px solid rgba(59,130,246,0.3);
            border-radius: 8px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            padding: 2px;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 2px; }
        input[type="color"]::-webkit-color-swatch { border-radius: 4px; border: none; }
    </style>
</head>
<body class="text-gray-300 bg-grid">

<!-- Mobile Menu Button -->
<button id="mobileMenuBtn" class="lg:hidden fixed top-4 left-4 z-[60] bg-slate-800 p-2.5 rounded-xl border border-slate-700 text-white" onclick="toggleSidebar()">
    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
</button>

<!-- Sidebar Overlay -->
<div id="sidebarOverlay" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden" onclick="toggleSidebar()"></div>

<!-- Sidebar -->
<aside id="sidebar" class="sidebar fixed top-0 left-0 h-screen flex flex-col z-50">
    <!-- Logo -->
    <div class="p-6 border-b border-slate-800">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-400 rounded-xl flex items-center justify-center text-lg font-black text-white">L</div>
            <div>
                <h1 class="font-extrabold text-white text-lg leading-tight">LenovoTuner</h1>
                <span class="text-[10px] font-bold text-blue-400 tracking-widest uppercase">Pro Edition</span>
            </div>
        </div>
    </div>

    <!-- Device Info -->
    <div class="p-4">
        <div class="profile-badge rounded-xl p-3">
            <div class="flex items-center gap-2 text-xs text-gray-400 mb-1">
                <span class="w-1.5 h-1.5 bg-green-400 rounded-full pulse-dot"></span>
                Dispositivo detectado
            </div>
            <p class="font-bold text-white text-sm">Lenovo IdeaPad</p>
            <p class="text-xs text-gray-500">Intel Core i3 ‚Ä¢ Windows 10/11</p>
        </div>
    </div>

    <!-- Nav -->
    <nav class="flex-1 overflow-y-auto px-3 py-2 space-y-1">
        <p class="text-[10px] font-bold text-gray-600 tracking-widest uppercase px-3 mb-2 mt-2">Sistema</p>
        <button class="sidebar-item active w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('dashboard')">
            <span class="text-lg">üìä</span> Dashboard
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('performance')">
            <span class="text-lg">‚ö°</span> Rendimiento
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('cleanup')">
            <span class="text-lg">üßπ</span> Limpieza
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('network')">
            <span class="text-lg">üåê</span> Red e Internet
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('power')">
            <span class="text-lg">üîã</span> Energ√≠a
        </button>

        <p class="text-[10px] font-bold text-gray-600 tracking-widest uppercase px-3 mb-2 mt-4">Personalizaci√≥n</p>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('keybinds')">
            <span class="text-lg">‚å®Ô∏è</span> Atajos de teclado
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('visual')">
            <span class="text-lg">üé®</span> Visual y UI
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('taskbar')">
            <span class="text-lg">üìå</span> Barra de tareas
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('explorer')">
            <span class="text-lg">üìÅ</span> Explorador
        </button>

        <p class="text-[10px] font-bold text-gray-600 tracking-widest uppercase px-3 mb-2 mt-4">Avanzado</p>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('privacy')">
            <span class="text-lg">üõ°Ô∏è</span> Privacidad
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('services')">
            <span class="text-lg">‚öôÔ∏è</span> Servicios Windows
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('gaming')">
            <span class="text-lg">üéÆ</span> Gaming
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('maintenance')">
            <span class="text-lg">üîß</span> Mantenimiento
        </button>

        <p class="text-[10px] font-bold text-gray-600 tracking-widest uppercase px-3 mb-2 mt-4">Exportar</p>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('export')">
            <span class="text-lg">üì¶</span> Exportar Scripts
        </button>
        <button class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-left" onclick="showSection('profiles')">
            <span class="text-lg">üíæ</span> Perfiles
        </button>
    </nav>

    <!-- Version -->
    <div class="p-4 border-t border-slate-800">
        <p class="text-[10px] text-gray-600 text-center">LenovoTuner Pro v2.0</p>
    </div>
</aside>

<!-- Main Content -->
<main id="mainContent" class="lg:ml-[280px] min-h-screen">
    <!-- Top Bar -->
    <div class="sticky top-0 z-30 bg-[#0a0e1a]/90 backdrop-blur-xl border-b border-slate-800/50 px-6 py-3">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3 ml-10 lg:ml-0">
                <h2 id="sectionTitle" class="text-lg font-bold text-white">Dashboard</h2>
                <span class="text-xs bg-blue-900/40 text-blue-400 px-2 py-0.5 rounded-full border border-blue-800/50" id="sectionBadge">Vista General</span>
            </div>
            <div class="flex items-center gap-3">
                <span id="changeCounter" class="text-xs code-font text-amber-400 bg-amber-900/30 px-3 py-1 rounded-full border border-amber-800/50 hidden">0 cambios pendientes</span>
                <button onclick="showSection('export')" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-semibold text-sm px-4 py-2 rounded-xl transition-all cursor-pointer flex items-center gap-2">
                    üì¶ Exportar
                </button>
            </div>
        </div>
    </div>

    <!-- Content Container -->
    <div class="p-6 max-w-7xl mx-auto" id="contentArea">
        <!-- Sections will be rendered here by JS -->
    </div>
</main>

<!-- Export Modal -->
<div id="exportModal" class="fixed inset-0 z-[100] hidden">
    <div class="modal-overlay absolute inset-0" onclick="closeExportModal()"></div>
    <div class="relative z-10 flex items-center justify-center min-h-screen p-4">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-4xl max-h-[85vh] overflow-hidden flex flex-col">
            <div class="flex items-center justify-between px-6 py-4 border-b border-slate-800">
                <div class="flex items-center gap-3">
                    <div class="flex gap-1.5">
                        <div class="w-3 h-3 bg-red-500 rounded-full cursor-pointer" onclick="closeExportModal()"></div>
                        <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                        <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                    </div>
                    <span class="text-sm text-gray-400 code-font" id="modalFileName">script.bat</span>
                </div>
                <div class="flex gap-2">
                    <button onclick="copyModalCode()" id="modalCopyBtn" class="bg-blue-600 hover:bg-blue-500 px-4 py-1.5 rounded-lg text-sm font-semibold transition-all cursor-pointer">üìã Copiar</button>
                    <button onclick="downloadModalCode()" class="bg-green-600 hover:bg-green-500 px-4 py-1.5 rounded-lg text-sm font-semibold transition-all cursor-pointer">‚¨áÔ∏è Descargar</button>
                </div>
            </div>
            <pre id="modalCode" class="flex-1 p-6 text-sm text-green-400 code-font overflow-auto"></pre>
        </div>
    </div>
</div>

<script>
// ==========================================
// STATE MANAGEMENT
// ==========================================
const state = {
    currentSection: 'dashboard',
    changes: {},
    profiles: {},
    keybinds: {},
    toggles: {},
    sliders: {},
    selects: {},
    colors: {}
};

let changeCount = 0;

function trackChange(key, value) {
    state.changes[key] = value;
    changeCount = Object.keys(state.changes).length;
    const counter = document.getElementById('changeCounter');
    if (changeCount > 0) {
        counter.classList.remove('hidden');
        counter.textContent = `${changeCount} cambios pendientes`;
    } else {
        counter.classList.add('hidden');
    }
}

// ==========================================
// NAVIGATION
// ==========================================
function toggleSidebar() {
    const sb = document.getElementById('sidebar');
    const ov = document.getElementById('sidebarOverlay');
    sb.classList.toggle('open');
    ov.classList.toggle('hidden');
}

function showSection(id) {
    state.currentSection = id;
    // Update sidebar
    document.querySelectorAll('.sidebar-item').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.sidebar-item').forEach(btn => {
        if (btn.textContent.trim().includes(sectionNames[id]?.nav || '---')) btn.classList.add('active');
    });
    // Update title
    const info = sectionNames[id] || { title: id, badge: '' };
    document.getElementById('sectionTitle').textContent = info.title;
    document.getElementById('sectionBadge').textContent = info.badge;
    // Render
    renderSection(id);
    // Mobile close
    document.getElementById('sidebar').classList.remove('open');
    document.getElementById('sidebarOverlay').classList.add('hidden');
    window.scrollTo({ top: 0 });
}

const sectionNames = {
    dashboard: { title: 'Dashboard', badge: 'Vista General', nav: 'Dashboard' },
    performance: { title: 'Rendimiento', badge: 'CPU ¬∑ RAM ¬∑ Disco', nav: 'Rendimiento' },
    cleanup: { title: 'Limpieza del Sistema', badge: 'Archivos ¬∑ Cach√© ¬∑ Bloatware', nav: 'Limpieza' },
    network: { title: 'Red e Internet', badge: 'DNS ¬∑ WiFi ¬∑ TCP/IP', nav: 'Red e Internet' },
    power: { title: 'Energ√≠a y Bater√≠a', badge: 'Plan ¬∑ Hibernaci√≥n ¬∑ Sleep', nav: 'Energ√≠a' },
    keybinds: { title: 'Atajos de Teclado', badge: 'Personalizar Keybinds', nav: 'Atajos de teclado' },
    visual: { title: 'Visual y Apariencia', badge: 'Temas ¬∑ Colores ¬∑ Efectos', nav: 'Visual y UI' },
    taskbar: { title: 'Barra de Tareas', badge: 'Iconos ¬∑ Posici√≥n ¬∑ B√∫squeda', nav: 'Barra de tareas' },
    explorer: { title: 'Explorador de Archivos', badge: 'Vistas ¬∑ Opciones ¬∑ Men√∫', nav: 'Explorador' },
    privacy: { title: 'Privacidad', badge: 'Telemetr√≠a ¬∑ Tracking ¬∑ Datos', nav: 'Privacidad' },
    services: { title: 'Servicios de Windows', badge: 'Activar ¬∑ Desactivar ¬∑ Configurar', nav: 'Servicios Windows' },
    gaming: { title: 'Optimizaci√≥n Gaming', badge: 'FPS ¬∑ Input Lag ¬∑ GPU', nav: 'Gaming' },
    maintenance: { title: 'Mantenimiento', badge: 'SFC ¬∑ DISM ¬∑ Registro', nav: 'Mantenimiento' },
    export: { title: 'Exportar Scripts', badge: 'BAT ¬∑ REG ¬∑ PS1', nav: 'Exportar Scripts' },
    profiles: { title: 'Perfiles de Configuraci√≥n', badge: 'Guardar ¬∑ Cargar', nav: 'Perfiles' }
};

// ==========================================
// RENDER HELPERS
// ==========================================
function makeToggle(id, label, desc, defaultOn = false, risk = 'bajo') {
    const checked = state.toggles[id] !== undefined ? state.toggles[id] : defaultOn;
    if (state.toggles[id] === undefined) state.toggles[id] = defaultOn;
    const riskColors = { bajo: 'text-green-400 bg-green-900/40 border-green-800/50', medio: 'text-yellow-400 bg-yellow-900/40 border-yellow-800/50', alto: 'text-red-400 bg-red-900/40 border-red-800/50' };
    return `
    <div class="opt-card rounded-xl p-4 ${checked ? 'selected' : ''}">
        <div class="flex items-center justify-between gap-4">
            <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 flex-wrap mb-1">
                    <span class="font-semibold text-white text-sm">${label}</span>
                    <span class="text-[10px] px-2 py-0.5 rounded-full border ${riskColors[risk]}">${risk}</span>
                </div>
                <p class="text-xs text-gray-500 leading-relaxed">${desc}</p>
            </div>
            <label class="toggle flex-shrink-0">
                <input type="checkbox" ${checked ? 'checked' : ''} onchange="onToggle('${id}', this.checked, this)">
                <div class="toggle-track"></div>
                <div class="toggle-knob"></div>
            </label>
        </div>
    </div>`;
}

function makeSlider(id, label, desc, min, max, defaultVal, unit = '') {
    const val = state.sliders[id] !== undefined ? state.sliders[id] : defaultVal;
    if (state.sliders[id] === undefined) state.sliders[id] = defaultVal;
    return `
    <div class="opt-card rounded-xl p-4">
        <div class="flex items-center justify-between mb-2">
            <span class="font-semibold text-white text-sm">${label}</span>
            <span class="code-font text-blue-400 text-sm" id="slider-val-${id}">${val}${unit}</span>
        </div>
        <p class="text-xs text-gray-500 mb-3">${desc}</p>
        <input type="range" min="${min}" max="${max}" value="${val}" class="w-full" oninput="onSlider('${id}', this.value, '${unit}')">
    </div>`;
}

function makeSelect(id, label, desc, options, defaultVal) {
    const val = state.selects[id] !== undefined ? state.selects[id] : defaultVal;
    if (state.selects[id] === undefined) state.selects[id] = defaultVal;
    const opts = options.map(o => `<option value="${o.value}" ${val === o.value ? 'selected' : ''}>${o.label}</option>`).join('');
    return `
    <div class="opt-card rounded-xl p-4">
        <div class="flex items-center justify-between mb-2 flex-wrap gap-2">
            <div class="flex-1 min-w-0">
                <span class="font-semibold text-white text-sm">${label}</span>
                <p class="text-xs text-gray-500 mt-1">${desc}</p>
            </div>
            <select class="custom-select rounded-lg px-3 py-2 text-sm pr-8" onchange="onSelect('${id}', this.value)">${opts}</select>
        </div>
    </div>`;
}

function makeKeybind(id, label, desc, defaultKey) {
    const val = state.keybinds[id] || defaultKey;
    if (!state.keybinds[id]) state.keybinds[id] = defaultKey;
    return `
    <div class="opt-card rounded-xl p-4">
        <div class="flex items-center justify-between gap-3">
            <div class="flex-1 min-w-0">
                <span class="font-semibold text-white text-sm">${label}</span>
                <p class="text-xs text-gray-500 mt-0.5">${desc}</p>
            </div>
            <div class="flex items-center gap-2">
                <input type="text" readonly 
                    class="keybind-input code-font text-sm text-amber-400 px-3 py-2 rounded-lg font-bold"
                    value="${val}" id="kb-${id}"
                    onclick="startRecording('${id}', this)"
                    placeholder="Presiona tecla...">
                <button onclick="resetKeybind('${id}', '${defaultKey}')" class="text-gray-600 hover:text-red-400 text-xs px-2 py-1 rounded transition-colors cursor-pointer" title="Resetear">‚Ü∫</button>
            </div>
        </div>
    </div>`;
}

function makeColorPicker(id, label, desc, defaultColor) {
    const val = state.colors[id] || defaultColor;
    if (!state.colors[id]) state.colors[id] = defaultColor;
    return `
    <div class="opt-card rounded-xl p-4">
        <div class="flex items-center justify-between gap-3">
            <div class="flex-1 min-w-0">
                <span class="font-semibold text-white text-sm">${label}</span>
                <p class="text-xs text-gray-500 mt-0.5">${desc}</p>
            </div>
            <div class="flex items-center gap-2">
                <input type="color" value="${val}" onchange="onColor('${id}', this.value)">
                <span class="code-font text-xs text-gray-500" id="color-val-${id}">${val}</span>
            </div>
        </div>
    </div>`;
}

function makeSectionHeader(icon, title, desc) {
    return `<div class="mb-6"><h3 class="text-xl font-bold text-white flex items-center gap-2">${icon} ${title}</h3><p class="text-sm text-gray-500 mt-1">${desc}</p></div>`;
}

function makeSubHeader(title) {
    return `<div class="mt-8 mb-4 flex items-center gap-2"><div class="h-px flex-1 bg-slate-800"></div><span class="text-xs font-bold text-gray-600 tracking-widest uppercase px-3">${title}</span><div class="h-px flex-1 bg-slate-800"></div></div>`;
}

// ==========================================
// EVENT HANDLERS
// ==========================================
function onToggle(id, checked, el) {
    state.toggles[id] = checked;
    trackChange(id, checked);
    const card = el.closest('.opt-card');
    if (checked) card.classList.add('selected'); else card.classList.remove('selected');
}
function onSlider(id, val, unit) {
    state.sliders[id] = parseInt(val);
    trackChange(id, val);
    document.getElementById('slider-val-' + id).textContent = val + unit;
}
function onSelect(id, val) {
    state.selects[id] = val;
    trackChange(id, val);
}
function onColor(id, val) {
    state.colors[id] = val;
    trackChange(id, val);
    const el = document.getElementById('color-val-' + id);
    if (el) el.textContent = val;
}

// Keybind recording
let recordingId = null;
let recordingEl = null;

function startRecording(id, el) {
    if (recordingEl) {
        recordingEl.classList.remove('recording');
        recordingEl.value = state.keybinds[recordingId] || '';
    }
    recordingId = id;
    recordingEl = el;
    el.classList.add('recording');
    el.value = '‚è∫ Presiona...';
}

function resetKeybind(id, defaultKey) {
    state.keybinds[id] = defaultKey;
    const el = document.getElementById('kb-' + id);
    if (el) { el.value = defaultKey; el.classList.remove('recording'); }
    trackChange('kb_' + id, defaultKey);
}

document.addEventListener('keydown', function(e) {
    if (!recordingId) return;
    e.preventDefault();
    let keys = [];
    if (e.ctrlKey) keys.push('Ctrl');
    if (e.altKey) keys.push('Alt');
    if (e.shiftKey) keys.push('Shift');
    if (e.metaKey) keys.push('Win');
    const key = e.key;
    if (!['Control','Alt','Shift','Meta'].includes(key)) {
        keys.push(key.length === 1 ? key.toUpperCase() : key);
    }
    const combo = keys.join(' + ');
    if (combo && !['Ctrl','Alt','Shift','Win'].includes(combo)) {
        state.keybinds[recordingId] = combo;
        recordingEl.value = combo;
        recordingEl.classList.remove('recording');
        trackChange('kb_' + recordingId, combo);
        recordingId = null;
        recordingEl = null;
    }
});

// ==========================================
// SECTIONS
// ==========================================
function renderSection(id) {
    const area = document.getElementById('contentArea');
    const renderers = {
        dashboard: renderDashboard,
        performance: renderPerformance,
        cleanup: renderCleanup,
        network: renderNetwork,
        power: renderPower,
        keybinds: renderKeybinds,
        visual: renderVisual,
        taskbar: renderTaskbar,
        explorer: renderExplorer,
        privacy: renderPrivacy,
        services: renderServices,
        gaming: renderGaming,
        maintenance: renderMaintenance,
        export: renderExport,
        profiles: renderProfiles
    };
    area.innerHTML = (renderers[id] || renderDashboard)();
}

// --- DASHBOARD ---
function renderDashboard() {
    const totalOpts = 85;
    const enabledCount = Object.values(state.toggles).filter(v => v).length;
    return `
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="stat-card rounded-xl p-4 text-center">
            <p class="text-3xl font-black text-blue-400">${totalOpts}</p>
            <p class="text-xs text-gray-500 mt-1">Opciones totales</p>
        </div>
        <div class="stat-card rounded-xl p-4 text-center">
            <p class="text-3xl font-black text-green-400">${enabledCount}</p>
            <p class="text-xs text-gray-500 mt-1">Activadas</p>
        </div>
        <div class="stat-card rounded-xl p-4 text-center">
            <p class="text-3xl font-black text-amber-400">${changeCount}</p>
            <p class="text-xs text-gray-500 mt-1">Cambios pendientes</p>
        </div>
        <div class="stat-card rounded-xl p-4 text-center">
            <p class="text-3xl font-black text-purple-400">3</p>
            <p class="text-xs text-gray-500 mt-1">Formatos de export</p>
        </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6 mb-8">
        <div class="opt-card rounded-2xl p-6">
            ${makeSectionHeader('üöÄ', 'Inicio R√°pido', 'Aplica configuraciones predeterminadas optimizadas')}
            <div class="space-y-3">
                <button onclick="applyPreset('balanced')" class="w-full text-left bg-blue-900/20 hover:bg-blue-900/40 border border-blue-800/30 rounded-xl p-4 transition-all cursor-pointer group">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-bold text-blue-300 group-hover:text-blue-200">‚öñÔ∏è Equilibrado</p>
                            <p class="text-xs text-gray-500 mt-1">Rendimiento + estabilidad. Ideal para uso diario.</p>
                        </div>
                        <span class="text-blue-500 text-xl group-hover:translate-x-1 transition-transform">‚Üí</span>
                    </div>
                </button>
                <button onclick="applyPreset('max_performance')" class="w-full text-left bg-amber-900/20 hover:bg-amber-900/40 border border-amber-800/30 rounded-xl p-4 transition-all cursor-pointer group">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-bold text-amber-300 group-hover:text-amber-200">üî• M√°ximo Rendimiento</p>
                            <p class="text-xs text-gray-500 mt-1">Todo al m√°ximo. Para sacar el 100% de tu i3.</p>
                        </div>
                        <span class="text-amber-500 text-xl group-hover:translate-x-1 transition-transform">‚Üí</span>
                    </div>
                </button>
                <button onclick="applyPreset('privacy')" class="w-full text-left bg-green-900/20 hover:bg-green-900/40 border border-green-800/30 rounded-xl p-4 transition-all cursor-pointer group">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-bold text-green-300 group-hover:text-green-200">üõ°Ô∏è M√°xima Privacidad</p>
                            <p class="text-xs text-gray-500 mt-1">Desactiva toda telemetr√≠a y tracking.</p>
                        </div>
                        <span class="text-green-500 text-xl group-hover:translate-x-1 transition-transform">‚Üí</span>
                    </div>
                </button>
                <button onclick="applyPreset('minimal')" class="w-full text-left bg-purple-900/20 hover:bg-purple-900/40 border border-purple-800/30 rounded-xl p-4 transition-all cursor-pointer group">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-bold text-purple-300 group-hover:text-purple-200">üßò M√≠nimo y Limpio</p>
                            <p class="text-xs text-gray-500 mt-1">Limpieza + bloatware. Sin cambios agresivos.</p>
                        </div>
                        <span class="text-purple-500 text-xl group-hover:translate-x-1 transition-transform">‚Üí</span>
                    </div>
                </button>
            </div>
        </div>
        <div class="opt-card rounded-2xl p-6">
            ${makeSectionHeader('üìã', 'Resumen de Categor√≠as', 'Qu√© incluye cada secci√≥n')}
            <div class="space-y-3">
                ${[
                    { icon: '‚ö°', name: 'Rendimiento', desc: 'CPU, RAM, SysMain, Prefetch, prioridades', count: 12 },
                    { icon: 'üßπ', name: 'Limpieza', desc: 'Temp, cach√©, bloatware, papelera', count: 8 },
                    { icon: 'üåê', name: 'Red', desc: 'DNS, TCP/IP, WiFi, latencia', count: 8 },
                    { icon: 'üîã', name: 'Energ√≠a', desc: 'Plan, hibernaci√≥n, USB suspend', count: 6 },
                    { icon: '‚å®Ô∏è', name: 'Keybinds', desc: 'Atajos personalizables del sistema', count: 12 },
                    { icon: 'üé®', name: 'Visual', desc: 'Animaciones, colores, dark mode', count: 10 },
                    { icon: 'üìå', name: 'Barra tareas', desc: 'Posici√≥n, iconos, b√∫squeda, widgets', count: 7 },
                    { icon: 'üõ°Ô∏è', name: 'Privacidad', desc: 'Telemetr√≠a, Cortana, anuncios, tracking', count: 10 },
                    { icon: 'üéÆ', name: 'Gaming', desc: 'Game Mode, DVR, input lag', count: 6 },
                ].map(c => `
                    <div class="flex items-center gap-3 text-sm">
                        <span>${c.icon}</span>
                        <span class="font-semibold text-white flex-1">${c.name}</span>
                        <span class="text-xs text-gray-500">${c.desc}</span>
                        <span class="code-font text-xs text-blue-400 bg-blue-900/30 px-2 py-0.5 rounded-full">${c.count}</span>
                    </div>`).join('')}
            </div>
        </div>
    </div>

    <div class="opt-card rounded-2xl p-6">
        <div class="flex items-start gap-3">
            <span class="text-2xl">‚ö†Ô∏è</span>
            <div>
                <h3 class="font-bold text-amber-300 text-lg">Antes de exportar</h3>
                <ul class="text-sm text-gray-400 mt-2 space-y-1">
                    <li>‚Ä¢ Crea un <strong>punto de restauraci√≥n</strong> (el script lo hace autom√°ticamente)</li>
                    <li>‚Ä¢ Ejecuta como <strong>Administrador</strong> (clic derecho ‚Üí Ejecutar como administrador)</li>
                    <li>‚Ä¢ Algunos cambios requieren <strong>reiniciar</strong></li>
                    <li>‚Ä¢ Revisa cada opci√≥n ‚Äî puedes desactivar lo que no necesites</li>
                </ul>
            </div>
        </div>
    </div>`;
}

// --- PERFORMANCE ---
function renderPerformance() {
    return `
    ${makeSectionHeader('‚ö°', 'Rendimiento del Sistema', 'Optimizaciones de CPU, RAM y disco para tu Intel Core i3')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('perf_sysmain', 'Desactivar SysMain (Superfetch)', 'Libera RAM y reduce uso de disco. Recomendado para laptops con poca RAM.', true, 'medio')}
        ${makeToggle('perf_prefetch', 'Desactivar Prefetch', 'Reduce escrituras al disco. √ötil si tienes SSD.', false, 'medio')}
        ${makeToggle('perf_indexing', 'Desactivar Windows Search Indexing', 'Reduce uso de CPU y disco. La b√∫squeda ser√° m√°s lenta.', true, 'bajo')}
        ${makeToggle('perf_visual', 'Optimizar efectos visuales', 'Desactiva animaciones para mejor rendimiento.', true, 'bajo')}
        ${makeToggle('perf_transparency', 'Desactivar transparencias', 'Reduce carga en GPU integrada del i3.', true, 'bajo')}
        ${makeToggle('perf_startup_delay', 'Eliminar retraso de inicio', 'Reduce el delay al abrir el men√∫ inicio.', true, 'bajo')}
        ${makeToggle('perf_menu_delay', 'Reducir delay de men√∫s', 'Respuesta m√°s r√°pida en men√∫s contextuales.', true, 'bajo')}
        ${makeToggle('perf_disable_tips', 'Desactivar tips de Windows', 'Elimina notificaciones de consejos que usan recursos.', true, 'bajo')}
        ${makeToggle('perf_priority_cpu', 'Priorizar programas en primer plano', 'Asigna m√°s CPU a la ventana activa.', true, 'bajo')}
        ${makeToggle('perf_large_cache', 'Optimizar cach√© del sistema', 'Configura cach√© de sistema para laptops.', false, 'medio')}
        ${makeToggle('perf_ntfs_disable_last', 'Desactivar √∫ltimo acceso NTFS', 'Reduce escrituras al disco mejorando rendimiento.', true, 'bajo')}
        ${makeToggle('perf_split_threshold', 'Optimizar umbral de memoria', 'Mejora la gesti√≥n de memoria en sistemas con poca RAM.', false, 'medio')}
    </div>
    ${makeSubHeader('Ajustes Avanzados')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeSlider('perf_menu_speed', 'Velocidad de men√∫s', 'Delay en milisegundos al abrir men√∫s (menor = m√°s r√°pido)', 0, 400, 50, 'ms')}
        ${makeSelect('perf_power_scheme', 'Esquema de procesador', 'Controla c√≥mo Windows gestiona el CPU', [
            { value: 'balanced', label: 'Equilibrado' },
            { value: 'high', label: 'Alto rendimiento' },
            { value: 'ultimate', label: 'M√°ximo rendimiento' }
        ], 'high')}
        ${makeSelect('perf_virtual_mem', 'Memoria virtual', 'Configuraci√≥n del archivo de paginaci√≥n', [
            { value: 'auto', label: 'Autom√°tico (recomendado)' },
            { value: 'custom', label: 'Personalizado (4-8GB)' },
            { value: 'none', label: 'Desactivar (solo con mucha RAM)' }
        ], 'auto')}
    </div>`;
}

// --- CLEANUP ---
function renderCleanup() {
    return `
    ${makeSectionHeader('üßπ', 'Limpieza del Sistema', 'Elimina archivos innecesarios y libera espacio en disco')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('clean_temp', 'Limpiar archivos temporales', 'Elimina archivos de %TEMP%, Windows\\Temp y Prefetch.', true, 'bajo')}
        ${makeToggle('clean_recycle', 'Vaciar papelera de reciclaje', 'Elimina todos los archivos de la papelera.', true, 'bajo')}
        ${makeToggle('clean_update_cache', 'Limpiar cach√© de Windows Update', 'Borra actualizaciones descargadas ya instaladas.', true, 'medio')}
        ${makeToggle('clean_thumbnail', 'Limpiar cach√© de miniaturas', 'Borra thumbnails. Se regeneran autom√°ticamente.', true, 'bajo')}
        ${makeToggle('clean_logs', 'Limpiar logs del sistema', 'Elimina archivos de log antiguos.', true, 'bajo')}
        ${makeToggle('clean_disk_cleanup', 'Ejecutar Liberador de Espacio', 'Lanza el limpiador de disco de Windows.', false, 'bajo')}
        ${makeToggle('clean_dns_cache', 'Limpiar cach√© DNS', 'Renueva la tabla de DNS local.', true, 'bajo')}
        ${makeToggle('clean_bloatware', 'Remover bloatware de Windows', 'Desinstala apps preinstaladas (Xbox, Noticias, Solitario, etc).', false, 'alto')}
    </div>`;
}

// --- NETWORK ---
function renderNetwork() {
    return `
    ${makeSectionHeader('üåê', 'Red e Internet', 'Optimiza tu conexi√≥n WiFi y configuraci√≥n de red')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('net_flush_dns', 'Flush DNS al iniciar', 'Limpia la cach√© DNS para resolver problemas de navegaci√≥n.', true, 'bajo')}
        ${makeToggle('net_reset_winsock', 'Reset Winsock', 'Restablece la pila de red para solucionar problemas WiFi.', false, 'medio')}
        ${makeToggle('net_reset_tcpip', 'Reset TCP/IP', 'Reinicia la configuraci√≥n TCP/IP.', false, 'medio')}
        ${makeToggle('net_disable_nagle', 'Desactivar algoritmo de Nagle', 'Reduce latencia en conexiones. Ideal para gaming y VoIP.', false, 'medio')}
        ${makeToggle('net_optimize_adapter', 'Optimizar adaptador de red', 'Ajusta buffers y configuraci√≥n del adaptador WiFi.', true, 'bajo')}
        ${makeToggle('net_disable_autotuning', 'Desactivar Auto-Tuning', 'Puede mejorar estabilidad WiFi en algunos routers.', false, 'medio')}
        ${makeToggle('net_qos_disable', 'Desactivar QoS reservado', 'Libera el 20% de ancho de banda que Windows reserva.', true, 'bajo')}
        ${makeToggle('net_disable_6to4', 'Desactivar IPv6 transiciones', 'Desactiva adaptadores de transici√≥n IPv6 innecesarios.', true, 'bajo')}
    </div>
    ${makeSubHeader('Servidor DNS')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeSelect('net_dns_provider', 'Proveedor DNS', 'Elige un DNS r√°pido y seguro', [
            { value: 'default', label: 'Autom√°tico (del ISP)' },
            { value: 'google', label: 'Google (8.8.8.8 / 8.8.4.4)' },
            { value: 'cloudflare', label: 'Cloudflare (1.1.1.1 / 1.0.0.1)' },
            { value: 'quad9', label: 'Quad9 (9.9.9.9 / 149.112.112.112)' },
            { value: 'opendns', label: 'OpenDNS (208.67.222.222)' }
        ], 'cloudflare')}
        ${makeSelect('net_adapter', 'Adaptador de red', 'Selecciona tu adaptador principal', [
            { value: 'wifi', label: 'Wi-Fi' },
            { value: 'ethernet', label: 'Ethernet' }
        ], 'wifi')}
    </div>`;
}

// --- POWER ---
function renderPower() {
    return `
    ${makeSectionHeader('üîã', 'Energ√≠a y Bater√≠a', 'Configura el plan de energ√≠a de tu IdeaPad')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('pwr_hibernate_off', 'Desactivar hibernaci√≥n', 'Libera espacio en disco (elimina hiberfil.sys de ~4GB).', true, 'bajo')}
        ${makeToggle('pwr_fast_startup', 'Desactivar inicio r√°pido', 'Puede resolver problemas de arranque. Inicio m√°s limpio.', false, 'bajo')}
        ${makeToggle('pwr_usb_suspend_off', 'Desactivar USB Selective Suspend', 'Evita que Windows apague dispositivos USB para ahorrar energ√≠a.', true, 'bajo')}
        ${makeToggle('pwr_hard_disk_off', 'Nunca apagar disco duro', 'Evita que el disco se duerma y cause lag al despertar.', true, 'bajo')}
        ${makeToggle('pwr_high_perf', 'Plan de Alto Rendimiento', 'Activa el plan de energ√≠a de alto rendimiento.', true, 'bajo')}
        ${makeToggle('pwr_processor_max', 'CPU al 100% siempre', 'Mantiene el procesador i3 al m√°ximo. Consume m√°s bater√≠a.', false, 'medio')}
    </div>
    ${makeSubHeader('Configuraci√≥n de Pantalla')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeSlider('pwr_screen_timeout_ac', 'Apagar pantalla (conectado)', 'Minutos antes de apagar la pantalla con cargador', 0, 60, 15, ' min')}
        ${makeSlider('pwr_screen_timeout_dc', 'Apagar pantalla (bater√≠a)', 'Minutos antes de apagar la pantalla con bater√≠a', 0, 30, 5, ' min')}
        ${makeSlider('pwr_sleep_ac', 'Suspender (conectado)', 'Minutos antes de suspender con cargador (0=nunca)', 0, 120, 30, ' min')}
        ${makeSlider('pwr_sleep_dc', 'Suspender (bater√≠a)', 'Minutos antes de suspender con bater√≠a', 0, 60, 15, ' min')}
    </div>`;
}

// --- KEYBINDS ---
function renderKeybinds() {
    return `
    ${makeSectionHeader('‚å®Ô∏è', 'Atajos de Teclado Personalizados', 'Configura keybinds del sistema. Haz clic en un campo y presiona la combinaci√≥n de teclas deseada.')}
    <div class="opt-card rounded-xl p-4 mb-6 border-l-4 border-amber-500">
        <p class="text-sm text-amber-200">üí° <strong>C√≥mo usar:</strong> Haz clic en el campo del atajo ‚Üí Presiona la combinaci√≥n de teclas deseada (ej: Ctrl+Shift+T). Se generar√° un script de AutoHotkey (.ahk) con todos tus atajos.</p>
    </div>
    ${makeSubHeader('Atajos del Sistema')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeKeybind('kb_screenshot', 'Captura de pantalla', 'Toma captura y guarda en Im√°genes', 'Win + Shift + S')}
        ${makeKeybind('kb_task_manager', 'Administrador de tareas', 'Abre el Task Manager directamente', 'Ctrl + Shift + Escape')}
        ${makeKeybind('kb_run_dialog', 'Ejecutar (Run)', 'Abre el di√°logo de Ejecutar', 'Win + R')}
        ${makeKeybind('kb_file_explorer', 'Explorador de archivos', 'Abre el explorador de archivos', 'Win + E')}
        ${makeKeybind('kb_cmd_admin', 'Terminal como Admin', 'Abre CMD/PowerShell como administrador', 'Ctrl + Shift + T')}
        ${makeKeybind('kb_desktop', 'Mostrar escritorio', 'Minimiza todo y muestra escritorio', 'Win + D')}
    </div>
    ${makeSubHeader('Atajos de Ventanas')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeKeybind('kb_close_window', 'Cerrar ventana activa', 'Cierra la ventana en primer plano', 'Alt + F4')}
        ${makeKeybind('kb_minimize_all', 'Minimizar todo', 'Minimiza todas las ventanas', 'Win + M')}
        ${makeKeybind('kb_snap_left', 'Ventana a la izquierda', 'Ajusta la ventana a la mitad izquierda', 'Win + Left')}
        ${makeKeybind('kb_snap_right', 'Ventana a la derecha', 'Ajusta la ventana a la mitad derecha', 'Win + Right')}
        ${makeKeybind('kb_maximize', 'Maximizar ventana', 'Maximiza la ventana activa', 'Win + Up')}
        ${makeKeybind('kb_switch_window', 'Cambiar ventana', 'Cambia entre ventanas abiertas', 'Alt + Tab')}
    </div>
    ${makeSubHeader('Atajos Multimedia')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeKeybind('kb_vol_up', 'Subir volumen', 'Incrementa el volumen del sistema', 'Ctrl + Up')}
        ${makeKeybind('kb_vol_down', 'Bajar volumen', 'Reduce el volumen del sistema', 'Ctrl + Down')}
        ${makeKeybind('kb_vol_mute', 'Silenciar', 'Alterna el silencio del sistema', 'Ctrl + M')}
        ${makeKeybind('kb_play_pause', 'Play/Pausa', 'Controla reproducci√≥n multimedia', 'Ctrl + Space')}
    </div>
    ${makeSubHeader('Atajos Personalizados')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeKeybind('kb_custom1', 'Acci√≥n r√°pida 1', 'Abrir Calculadora', 'Ctrl + Alt + C')}
        ${makeKeybind('kb_custom2', 'Acci√≥n r√°pida 2', 'Abrir Bloc de notas', 'Ctrl + Alt + N')}
    </div>`;
}

// --- VISUAL ---
function renderVisual() {
    return `
    ${makeSectionHeader('üé®', 'Visual y Apariencia', 'Personaliza la apariencia de Windows')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('vis_dark_mode', 'Modo oscuro del sistema', 'Activa el tema oscuro en Windows y apps.', true, 'bajo')}
        ${makeToggle('vis_dark_apps', 'Modo oscuro en apps', 'Fuerza tema oscuro en aplicaciones compatibles.', true, 'bajo')}
        ${makeToggle('vis_disable_anim', 'Desactivar animaciones', 'Elimina animaciones de ventanas para m√°s fluidez.', true, 'bajo')}
        ${makeToggle('vis_disable_transparency', 'Desactivar transparencias', 'Quita los efectos de transparencia del sistema.', true, 'bajo')}
        ${makeToggle('vis_disable_shadow', 'Desactivar sombras de ventanas', 'Elimina sombras bajo las ventanas.', false, 'bajo')}
        ${makeToggle('vis_smooth_scroll', 'Desactivar smooth scrolling', 'Scroll m√°s directo sin suavizado.', false, 'bajo')}
        ${makeToggle('vis_disable_peek', 'Desactivar Aero Peek', 'No mostrar vista previa al pasar sobre la barra de tareas.', false, 'bajo')}
        ${makeToggle('vis_disable_snap_assist', 'Desactivar Snap Assist', 'No mostrar sugerencias al hacer snap de ventanas.', false, 'bajo')}
        ${makeToggle('vis_small_icons', 'Usar iconos peque√±os en escritorio', 'Reduce el tama√±o de iconos del escritorio.', false, 'bajo')}
        ${makeToggle('vis_show_extensions', 'Mostrar extensiones de archivo', 'Muestra .exe, .txt, .jpg etc. en todos los archivos.', true, 'bajo')}
    </div>
    ${makeSubHeader('Colores del Sistema')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeColorPicker('color_accent', 'Color de acento', 'Color principal del sistema (barra de t√≠tulo, botones)', '#0078d4')}
        ${makeColorPicker('color_taskbar', 'Color de barra de tareas', 'Color de fondo de la barra de tareas', '#1a1a2e')}
    </div>
    ${makeSubHeader('Cursor y Mouse')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeSlider('vis_cursor_speed', 'Velocidad del cursor', 'Velocidad de movimiento del rat√≥n', 1, 20, 10, '')}
        ${makeToggle('vis_enhance_pointer', 'Mejorar precisi√≥n del puntero', 'Aceleraci√≥n del mouse (desactivar para gaming)', false, 'bajo')}
    </div>`;
}

// --- TASKBAR ---
function renderTaskbar() {
    return `
    ${makeSectionHeader('üìå', 'Barra de Tareas', 'Configura la barra de tareas de Windows')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('tb_hide_search', 'Ocultar barra de b√∫squeda', 'Elimina la barra/√≠cono de b√∫squeda.', true, 'bajo')}
        ${makeToggle('tb_hide_task_view', 'Ocultar Vista de tareas', 'Quita el bot√≥n de vista de tareas.', true, 'bajo')}
        ${makeToggle('tb_hide_widgets', 'Ocultar Widgets', 'Quita el panel de widgets (Win 11).', true, 'bajo')}
        ${makeToggle('tb_hide_chat', 'Ocultar Chat/Teams', 'Quita el √≠cono de Chat de Teams.', true, 'bajo')}
        ${makeToggle('tb_hide_copilot', 'Ocultar Copilot', 'Quita el bot√≥n de Copilot (Win 11).', true, 'bajo')}
        ${makeToggle('tb_small_icons', 'Iconos peque√±os', 'Usa iconos m√°s peque√±os en la barra (Win 10).', false, 'bajo')}
        ${makeToggle('tb_never_combine', 'No combinar botones', 'Muestra cada ventana por separado en la barra.', false, 'bajo')}
    </div>
    ${makeSubHeader('Posici√≥n y Comportamiento')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeSelect('tb_position', 'Posici√≥n de la barra', 'D√≥nde aparece la barra de tareas', [
            { value: 'bottom', label: 'Abajo (predeterminado)' },
            { value: 'top', label: 'Arriba' },
            { value: 'left', label: 'Izquierda' },
            { value: 'right', label: 'Derecha' }
        ], 'bottom')}
        ${makeSelect('tb_alignment', 'Alineaci√≥n de iconos (Win11)', 'D√≥nde se alinean los iconos en la barra', [
            { value: 'center', label: 'Centro (predeterminado)' },
            { value: 'left', label: 'Izquierda (estilo Win 10)' }
        ], 'left')}
    </div>`;
}

// --- EXPLORER ---
function renderExplorer() {
    return `
    ${makeSectionHeader('üìÅ', 'Explorador de Archivos', 'Personaliza el explorador de archivos de Windows')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('exp_show_extensions', 'Mostrar extensiones de archivo', 'Muestra .exe, .txt, .jpg en todos los archivos.', true, 'bajo')}
        ${makeToggle('exp_show_hidden', 'Mostrar archivos ocultos', 'Muestra archivos y carpetas ocultas.', true, 'bajo')}
        ${makeToggle('exp_show_system', 'Mostrar archivos del sistema', 'Muestra archivos protegidos del sistema operativo.', false, 'medio')}
        ${makeToggle('exp_open_this_pc', 'Abrir en "Este equipo"', 'Abre el explorador en Este equipo en vez de Acceso r√°pido.', true, 'bajo')}
        ${makeToggle('exp_disable_recent', 'Desactivar archivos recientes', 'No mostrar archivos usados recientemente.', true, 'bajo')}
        ${makeToggle('exp_disable_frequent', 'Desactivar carpetas frecuentes', 'No mostrar carpetas usadas frecuentemente.', true, 'bajo')}
        ${makeToggle('exp_full_path', 'Mostrar ruta completa', 'Muestra la ruta completa en la barra de t√≠tulo.', true, 'bajo')}
        ${makeToggle('exp_classic_menu', 'Men√∫ contextual cl√°sico (Win11)', 'Muestra el men√∫ completo sin "Mostrar m√°s opciones".', true, 'bajo')}
        ${makeToggle('exp_compact_view', 'Vista compacta', 'Reduce el espaciado entre archivos (Win 11).', true, 'bajo')}
        ${makeToggle('exp_disable_grouping', 'Desactivar agrupaci√≥n en Descargas', 'No agrupar archivos por fecha en la carpeta Descargas.', true, 'bajo')}
    </div>`;
}

// --- PRIVACY ---
function renderPrivacy() {
    return `
    ${makeSectionHeader('üõ°Ô∏è', 'Privacidad y Telemetr√≠a', 'Controla qu√© datos env√≠a tu PC a Microsoft')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('priv_telemetry', 'Desactivar telemetr√≠a', 'Bloquea el env√≠o de datos de diagn√≥stico a Microsoft.', true, 'medio')}
        ${makeToggle('priv_cortana', 'Desactivar Cortana', 'Deshabilita Cortana completamente.', true, 'bajo')}
        ${makeToggle('priv_activity_history', 'Desactivar historial de actividad', 'No guardar ni enviar historial de actividades.', true, 'bajo')}
        ${makeToggle('priv_ad_id', 'Desactivar ID de publicidad', 'No usar ID de publicidad para personalizar anuncios.', true, 'bajo')}
        ${makeToggle('priv_location', 'Desactivar ubicaci√≥n', 'No compartir tu ubicaci√≥n con apps.', true, 'bajo')}
        ${makeToggle('priv_diagnostic_data', 'Datos de diagn√≥stico m√≠nimos', 'Solo enviar datos de diagn√≥stico obligatorios.', true, 'bajo')}
        ${makeToggle('priv_tailored_exp', 'Desactivar experiencias personalizadas', 'No recibir tips ni anuncios basados en diagn√≥sticos.', true, 'bajo')}
        ${makeToggle('priv_feedback', 'Desactivar solicitudes de feedback', 'Windows no te pedir√° enviar opiniones.', true, 'bajo')}
        ${makeToggle('priv_start_suggestions', 'Desactivar sugerencias en Inicio', 'No mostrar apps sugeridas en el men√∫ inicio.', true, 'bajo')}
        ${makeToggle('priv_lock_screen_tips', 'Desactivar tips en pantalla de bloqueo', 'No mostrar datos curiosos ni anuncios en el lock screen.', true, 'bajo')}
    </div>`;
}

// --- SERVICES ---
function renderServices() {
    return `
    ${makeSectionHeader('‚öôÔ∏è', 'Servicios de Windows', 'Desactiva servicios que no necesitas para liberar recursos')}
    <div class="opt-card rounded-xl p-4 mb-6 border-l-4 border-red-500">
        <p class="text-sm text-red-200">‚ö†Ô∏è <strong>Cuidado:</strong> Desactivar servicios incorrectos puede causar problemas. Solo desactiva lo que entiendas.</p>
    </div>
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('svc_diagtrack', 'Experiencias de usuario (DiagTrack)', 'Telemetr√≠a principal de Windows. Seguro desactivar.', true, 'medio')}
        ${makeToggle('svc_dmwappush', 'dmwappushservice', 'Servicio de telemetr√≠a WAP push. Seguro desactivar.', true, 'medio')}
        ${makeToggle('svc_sysmain', 'SysMain (Superfetch)', 'Pre-carga apps en RAM. Desactivar si tienes poca RAM.', true, 'medio')}
        ${makeToggle('svc_wsearch', 'Windows Search', 'Indexa archivos para b√∫squeda. Usa CPU y disco.', true, 'medio')}
        ${makeToggle('svc_xbox', 'Servicios de Xbox', 'XboxGipSvc, XblAuthManager, XblGameSave. No necesarios sin Xbox.', true, 'bajo')}
        ${makeToggle('svc_maps', 'Administrador de mapas', 'Descarga mapas para uso offline. Innecesario para la mayor√≠a.', true, 'bajo')}
        ${makeToggle('svc_fax', 'Servicio de Fax', 'Soporte para env√≠o de fax. Raramente necesario.', true, 'bajo')}
        ${makeToggle('svc_print_spooler', 'Servicio de impresi√≥n', 'Solo necesario si usas impresora. Desactivar si no.', false, 'medio')}
        ${makeToggle('svc_remote_registry', 'Registro remoto', 'Permite acceso remoto al registro. Riesgo de seguridad.', true, 'bajo')}
        ${makeToggle('svc_bluetooth', 'Bluetooth (si no lo usas)', 'Desactiva Bluetooth para ahorrar bater√≠a y recursos.', false, 'bajo')}
    </div>`;
}

// --- GAMING ---
function renderGaming() {
    return `
    ${makeSectionHeader('üéÆ', 'Optimizaci√≥n Gaming', 'Configuraciones para mejorar el rendimiento en juegos')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('game_mode', 'Activar Game Mode', 'Prioriza recursos del sistema para el juego activo.', true, 'bajo')}
        ${makeToggle('game_dvr_off', 'Desactivar Game DVR/Bar', 'Elimina la grabaci√≥n de pantalla en segundo plano. Libera FPS.', true, 'bajo')}
        ${makeToggle('game_fullscreen_opt', 'Desactivar optimizaci√≥n pantalla completa', 'Puede mejorar FPS y reducir input lag.', true, 'bajo')}
        ${makeToggle('game_mouse_accel', 'Desactivar aceleraci√≥n del mouse', 'Movimiento 1:1 del rat√≥n. Esencial para shooters.', true, 'bajo')}
        ${makeToggle('game_nagle_off', 'Desactivar Nagle (reducir ping)', 'Reduce la latencia de red en juegos online.', true, 'medio')}
        ${makeToggle('game_hpet_off', 'Desactivar HPET', 'Puede mejorar rendimiento en algunos juegos. Testear.', false, 'alto')}
    </div>
    ${makeSubHeader('Ajustes de GPU')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeSelect('game_gpu_sched', 'GPU Scheduling (Win 10 2004+)', 'Planificaci√≥n de GPU por hardware', [
            { value: 'off', label: 'Desactivado' },
            { value: 'on', label: 'Activado (recomendado)' }
        ], 'on')}
        ${makeSelect('game_power_mode', 'Modo de energ√≠a GPU', 'Preferencia de rendimiento de gr√°ficos', [
            { value: 'balanced', label: 'Equilibrado' },
            { value: 'high', label: 'Alto rendimiento' }
        ], 'high')}
    </div>`;
}

// --- MAINTENANCE ---
function renderMaintenance() {
    return `
    ${makeSectionHeader('üîß', 'Mantenimiento del Sistema', 'Reparaci√≥n y mantenimiento de Windows')}
    <div class="grid md:grid-cols-2 gap-4">
        ${makeToggle('maint_sfc', 'Ejecutar SFC /scannow', 'Repara archivos del sistema corrupto o faltantes.', true, 'bajo')}
        ${makeToggle('maint_dism', 'Ejecutar DISM RestoreHealth', 'Repara la imagen de Windows antes del SFC.', true, 'bajo')}
        ${makeToggle('maint_chkdsk', 'Verificar disco (chkdsk)', 'Busca y repara errores en el disco duro.', false, 'medio')}
        ${makeToggle('maint_defrag', 'Optimizar disco', 'Desfragmenta HDD o ejecuta TRIM en SSD.', true, 'bajo')}
        ${makeToggle('maint_restore_point', 'Crear punto de restauraci√≥n', 'Crea un punto de restauraci√≥n antes de los cambios.', true, 'bajo')}
        ${makeToggle('maint_clear_event_log', 'Limpiar logs de eventos', 'Borra los registros de eventos del sistema.', false, 'bajo')}
    </div>`;
}

// --- EXPORT ---
function renderExport() {
    return `
    ${makeSectionHeader('üì¶', 'Exportar Scripts', 'Genera scripts listos para ejecutar con todas tus configuraciones')}
    <div class="grid md:grid-cols-3 gap-6 mb-8">
        <button onclick="generateAndShow('bat')" class="opt-card rounded-2xl p-6 text-center hover:border-blue-500/50 transition-all cursor-pointer group">
            <div class="text-4xl mb-3">üìÑ</div>
            <h3 class="font-bold text-white text-lg group-hover:text-blue-400 transition-colors">Script .BAT</h3>
            <p class="text-xs text-gray-500 mt-2">Archivo batch ejecutable. Compatible con Windows 10/11. El m√°s f√°cil de usar.</p>
            <div class="mt-4 bg-blue-600/20 text-blue-400 text-xs font-bold px-3 py-1.5 rounded-lg border border-blue-800/50">Generar .BAT</div>
        </button>
        <button onclick="generateAndShow('reg')" class="opt-card rounded-2xl p-6 text-center hover:border-green-500/50 transition-all cursor-pointer group">
            <div class="text-4xl mb-3">üóùÔ∏è</div>
            <h3 class="font-bold text-white text-lg group-hover:text-green-400 transition-colors">Registro .REG</h3>
            <p class="text-xs text-gray-500 mt-2">Archivo de registro de Windows. Aplica cambios visuales, de rendimiento y privacidad.</p>
            <div class="mt-4 bg-green-600/20 text-green-400 text-xs font-bold px-3 py-1.5 rounded-lg border border-green-800/50">Generar .REG</div>
        </button>
        <button onclick="generateAndShow('ps1')" class="opt-card rounded-2xl p-6 text-center hover:border-purple-500/50 transition-all cursor-pointer group">
            <div class="text-4xl mb-3">‚ö°</div>
            <h3 class="font-bold text-white text-lg group-hover:text-purple-400 transition-colors">PowerShell .PS1</h3>
            <p class="text-xs text-gray-500 mt-2">Script de PowerShell avanzado. Incluye bloatware removal y configuraciones avanzadas.</p>
            <div class="mt-4 bg-purple-600/20 text-purple-400 text-xs font-bold px-3 py-1.5 rounded-lg border border-purple-800/50">Generar .PS1</div>
        </button>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
        <button onclick="generateAndShow('ahk')" class="opt-card rounded-2xl p-6 text-center hover:border-amber-500/50 transition-all cursor-pointer group">
            <div class="text-4xl mb-3">‚å®Ô∏è</div>
            <h3 class="font-bold text-white text-lg group-hover:text-amber-400 transition-colors">AutoHotkey .AHK</h3>
            <p class="text-xs text-gray-500 mt-2">Script de atajos de teclado personalizados. Requiere AutoHotkey instalado.</p>
            <div class="mt-4 bg-amber-600/20 text-amber-400 text-xs font-bold px-3 py-1.5 rounded-lg border border-amber-800/50">Generar .AHK</div>
        </button>
        <button onclick="generateAndShow('all')" class="opt-card rounded-2xl p-6 text-center hover:border-cyan-500/50 transition-all cursor-pointer group border-cyan-800/30">
            <div class="text-4xl mb-3">üéÅ</div>
            <h3 class="font-bold text-white text-lg group-hover:text-cyan-400 transition-colors">Todo-en-Uno .BAT</h3>
            <p class="text-xs text-gray-500 mt-2">Un solo archivo .BAT que incluye TODAS las configuraciones seleccionadas.</p>
            <div class="mt-4 bg-cyan-600/20 text-cyan-400 text-xs font-bold px-3 py-1.5 rounded-lg border border-cyan-800/50">‚≠ê Generar Todo</div>
        </button>
    </div>

    <div class="mt-8 opt-card rounded-xl p-5">
        <h4 class="font-bold text-white mb-3">üìã Instrucciones</h4>
        <div class="grid md:grid-cols-4 gap-4 text-center text-sm">
            <div><div class="text-2xl mb-2">1Ô∏è‚É£</div><p class="text-gray-400">Configura tus opciones en cada secci√≥n</p></div>
            <div><div class="text-2xl mb-2">2Ô∏è‚É£</div><p class="text-gray-400">Elige el formato y haz clic en Generar</p></div>
            <div><div class="text-2xl mb-2">3Ô∏è‚É£</div><p class="text-gray-400">Descarga el archivo o copia el c√≥digo</p></div>
            <div><div class="text-2xl mb-2">4Ô∏è‚É£</div><p class="text-gray-400">Ejecuta como Administrador y reinicia</p></div>
        </div>
    </div>`;
}

// --- PROFILES ---
function renderProfiles() {
    return `
    ${makeSectionHeader('üíæ', 'Perfiles de Configuraci√≥n', 'Guarda y carga configuraciones r√°pidamente')}
    <div class="grid md:grid-cols-2 gap-4 mb-6">
        <div class="opt-card rounded-xl p-5">
            <h4 class="font-bold text-white mb-3">üíæ Guardar perfil actual</h4>
            <input type="text" id="profileName" placeholder="Nombre del perfil..." class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-sm mb-3 focus:border-blue-500 focus:outline-none text-white">
            <button onclick="saveProfile()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-semibold py-2 rounded-lg transition-all cursor-pointer text-sm">Guardar Perfil</button>
        </div>
        <div class="opt-card rounded-xl p-5">
            <h4 class="font-bold text-white mb-3">üìÇ Exportar/Importar configuraci√≥n</h4>
            <div class="flex gap-2">
                <button onclick="exportConfig()" class="flex-1 bg-green-600 hover:bg-green-500 text-white font-semibold py-2 rounded-lg transition-all cursor-pointer text-sm">üì§ Exportar JSON</button>
                <label class="flex-1 bg-purple-600 hover:bg-purple-500 text-white font-semibold py-2 rounded-lg transition-all cursor-pointer text-sm text-center">
                    üì• Importar
                    <input type="file" accept=".json" class="hidden" onchange="importConfig(event)">
                </label>
            </div>
        </div>
    </div>
    <div id="savedProfiles">
        <h4 class="font-bold text-white mb-3">üìã Perfiles guardados</h4>
        <div id="profilesList" class="space-y-2">
            <p class="text-sm text-gray-500 text-center py-4">No hay perfiles guardados a√∫n.</p>
        </div>
    </div>`;
}


// ==========================================
// PRESETS
// ==========================================
function applyPreset(preset) {
    // Reset all
    Object.keys(state.toggles).forEach(k => state.toggles[k] = false);

    const presets = {
        balanced: ['perf_sysmain','perf_indexing','perf_visual','perf_transparency','perf_startup_delay','perf_menu_delay','perf_disable_tips','perf_priority_cpu','perf_ntfs_disable_last','clean_temp','clean_recycle','clean_thumbnail','clean_dns_cache','net_flush_dns','net_qos_disable','pwr_hibernate_off','pwr_high_perf','priv_telemetry','priv_cortana','priv_ad_id','priv_tailored_exp','priv_feedback','priv_start_suggestions','tb_hide_search','tb_hide_task_view','tb_hide_widgets','tb_hide_chat','tb_hide_copilot','exp_show_extensions','exp_open_this_pc','exp_disable_recent','vis_dark_mode','vis_dark_apps','svc_diagtrack','svc_dmwappush','maint_restore_point'],
        max_performance: ['perf_sysmain','perf_prefetch','perf_indexing','perf_visual','perf_transparency','perf_startup_delay','perf_menu_delay','perf_disable_tips','perf_priority_cpu','perf_large_cache','perf_ntfs_disable_last','perf_split_threshold','clean_temp','clean_recycle','clean_update_cache','clean_thumbnail','clean_logs','clean_dns_cache','clean_bloatware','net_flush_dns','net_disable_nagle','net_qos_disable','net_disable_6to4','pwr_hibernate_off','pwr_usb_suspend_off','pwr_hard_disk_off','pwr_high_perf','pwr_processor_max','priv_telemetry','priv_cortana','priv_activity_history','priv_ad_id','priv_tailored_exp','priv_feedback','priv_start_suggestions','priv_lock_screen_tips','tb_hide_search','tb_hide_task_view','tb_hide_widgets','tb_hide_chat','tb_hide_copilot','vis_dark_mode','vis_dark_apps','vis_disable_anim','vis_disable_transparency','vis_disable_shadow','svc_diagtrack','svc_dmwappush','svc_sysmain','svc_wsearch','svc_xbox','svc_maps','svc_fax','svc_remote_registry','game_mode','game_dvr_off','game_fullscreen_opt','game_mouse_accel','game_nagle_off','exp_show_extensions','exp_open_this_pc','exp_classic_menu','exp_compact_view','maint_sfc','maint_dism','maint_defrag','maint_restore_point'],
        privacy: ['priv_telemetry','priv_cortana','priv_activity_history','priv_ad_id','priv_location','priv_diagnostic_data','priv_tailored_exp','priv_feedback','priv_start_suggestions','priv_lock_screen_tips','svc_diagtrack','svc_dmwappush','tb_hide_widgets','tb_hide_chat','tb_hide_copilot','net_disable_6to4','maint_restore_point'],
        minimal: ['clean_temp','clean_recycle','clean_thumbnail','clean_dns_cache','perf_disable_tips','perf_startup_delay','perf_menu_delay','tb_hide_search','tb_hide_widgets','tb_hide_chat','tb_hide_copilot','exp_show_extensions','exp_open_this_pc','vis_dark_mode','vis_dark_apps','maint_restore_point']
    };

    if (presets[preset]) {
        presets[preset].forEach(k => { state.toggles[k] = true; trackChange(k, true); });
    }
    renderSection(state.currentSection);
    alert('‚úÖ Preset aplicado: ' + { balanced: 'Equilibrado', max_performance: 'M√°ximo Rendimiento', privacy: 'M√°xima Privacidad', minimal: 'M√≠nimo y Limpio' }[preset]);
}


// ==========================================
// SCRIPT GENERATORS
// ==========================================
function generateBat() {
    let s = `@echo off
chcp 65001 >nul
title ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LENOVOTUNER PRO ‚Äî Optimizador Integral ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
color 0A
echo.
echo  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo  ‚ïë                                                          ‚ïë
echo  ‚ïë        LENOVOTUNER PRO ‚Äî Optimizador Integral            ‚ïë
echo  ‚ïë        Lenovo IdeaPad ‚Äî Intel Core i3                    ‚ïë
echo  ‚ïë                                                          ‚ïë
echo  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.

:: Verificar Administrador
net session >nul 2>&1
if %errorlevel% neq 0 (
    echo [ERROR] Se requieren permisos de ADMINISTRADOR.
    echo Clic derecho -^> Ejecutar como administrador.
    pause & exit /b 1
)
echo [OK] Permisos de administrador verificados.
echo [INFO] Fecha: %date% ‚Äî Hora: %time%
echo.
`;

    if (state.toggles['maint_restore_point']) s += `
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo   Creando punto de restauracion...
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
PowerShell -Command "Checkpoint-Computer -Description 'LenovoTuner_Backup' -RestorePointType 'MODIFY_SETTINGS'" 2>nul
echo [OK] Punto de restauracion creado.
`;

    // Performance
    if (state.toggles['perf_sysmain']) s += `\necho [*] Desactivando SysMain...\nsc config "SysMain" start= disabled >nul 2>&1\nsc stop "SysMain" >nul 2>&1\necho [OK] SysMain desactivado.\n`;
    if (state.toggles['perf_prefetch']) s += `\necho [*] Desactivando Prefetch...\nreg add "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters" /v EnablePrefetcher /t REG_DWORD /d 0 /f >nul\nreg add "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Memory Management\\PrefetchParameters" /v EnableSuperfetch /t REG_DWORD /d 0 /f >nul\necho [OK] Prefetch desactivado.\n`;
    if (state.toggles['perf_indexing']) s += `\necho [*] Desactivando Windows Search Indexing...\nsc config "WSearch" start= disabled >nul 2>&1\nsc stop "WSearch" >nul 2>&1\necho [OK] Indexacion desactivada.\n`;
    if (state.toggles['perf_visual']) s += `\necho [*] Optimizando efectos visuales...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\VisualEffects" /v VisualFXSetting /t REG_DWORD /d 2 /f >nul\nreg add "HKCU\\Control Panel\\Desktop\\WindowMetrics" /v MinAnimate /t REG_SZ /d "0" /f >nul\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced" /v TaskbarAnimations /t REG_DWORD /d 0 /f >nul\necho [OK] Efectos visuales optimizados.\n`;
    if (state.toggles['perf_transparency']) s += `\necho [*] Desactivando transparencias...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize" /v EnableTransparency /t REG_DWORD /d 0 /f >nul\necho [OK] Transparencias desactivadas.\n`;
    if (state.toggles['perf_startup_delay']) s += `\necho [*] Eliminando retraso de inicio...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Serialize" /v StartupDelayInMSec /t REG_DWORD /d 0 /f >nul\necho [OK] Retraso de inicio eliminado.\n`;
    if (state.toggles['perf_menu_delay']) s += `\necho [*] Reduciendo delay de menus...\nreg add "HKCU\\Control Panel\\Desktop" /v MenuShowDelay /t REG_SZ /d "${state.sliders['perf_menu_speed'] || 50}" /f >nul\necho [OK] Delay de menus: ${state.sliders['perf_menu_speed'] || 50}ms.\n`;
    if (state.toggles['perf_disable_tips']) s += `\necho [*] Desactivando tips de Windows...\nreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\CloudContent" /v DisableSoftLanding /t REG_DWORD /d 1 /f >nul\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\ContentDeliveryManager" /v SubscribedContent-338389Enabled /t REG_DWORD /d 0 /f >nul\necho [OK] Tips desactivados.\n`;
    if (state.toggles['perf_priority_cpu']) s += `\necho [*] Priorizando programas en primer plano...\nreg add "HKLM\\SYSTEM\\CurrentControlSet\\Control\\PriorityControl" /v Win32PrioritySeparation /t REG_DWORD /d 38 /f >nul\necho [OK] CPU prioriza primer plano.\n`;
    if (state.toggles['perf_ntfs_disable_last']) s += `\necho [*] Desactivando ultimo acceso NTFS...\nfsutil behavior set disablelastaccess 1 >nul\necho [OK] Ultimo acceso NTFS desactivado.\n`;

    // Cleanup
    if (state.toggles['clean_temp']) s += `\necho [*] Limpiando archivos temporales...\ndel /q /f /s "%TEMP%\\*" 2>nul\ndel /q /f /s "C:\\Windows\\Temp\\*" 2>nul\ndel /q /f /s "C:\\Windows\\Prefetch\\*" 2>nul\necho [OK] Temporales limpiados.\n`;
    if (state.toggles['clean_recycle']) s += `\necho [*] Vaciando papelera...\nrd /s /q C:\\$Recycle.Bin 2>nul\necho [OK] Papelera vaciada.\n`;
    if (state.toggles['clean_update_cache']) s += `\necho [*] Limpiando cache de Windows Update...\nnet stop wuauserv >nul 2>&1\ndel /q /f /s "C:\\Windows\\SoftwareDistribution\\Download\\*" 2>nul\nnet start wuauserv >nul 2>&1\necho [OK] Cache de Update limpiada.\n`;
    if (state.toggles['clean_thumbnail']) s += `\necho [*] Limpiando cache de miniaturas...\ndel /f /s /q "%LocalAppData%\\Microsoft\\Windows\\Explorer\\thumbcache_*.db" 2>nul\necho [OK] Miniaturas limpiadas.\n`;
    if (state.toggles['clean_logs']) s += `\necho [*] Limpiando logs del sistema...\nfor /F "tokens=*" %%G in ('wevtutil el') do wevtutil cl "%%G" 2>nul\necho [OK] Logs limpiados.\n`;
    if (state.toggles['clean_dns_cache']) s += `\necho [*] Limpiando cache DNS...\nipconfig /flushdns >nul\necho [OK] Cache DNS limpiada.\n`;
    if (state.toggles['clean_bloatware']) s += `\necho [*] Removiendo bloatware...\nPowerShell -Command "Get-AppxPackage *3dbuilder* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *getstarted* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *solitairecollection* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *bingfinance* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *bingnews* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *bingsports* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *bingweather* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *zunevideo* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *zunemusic* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *xboxapp* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *officehub* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *skypeapp* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *windowsmaps* | Remove-AppxPackage" 2>nul\nPowerShell -Command "Get-AppxPackage *clipchamp* | Remove-AppxPackage" 2>nul\necho [OK] Bloatware removido.\n`;

    // Network
    if (state.toggles['net_flush_dns']) s += `\necho [*] Flush DNS...\nipconfig /flushdns >nul\nipconfig /registerdns >nul\necho [OK] DNS renovado.\n`;
    if (state.toggles['net_reset_winsock']) s += `\necho [*] Reseteando Winsock...\nnetsh winsock reset >nul\necho [OK] Winsock reseteado.\n`;
    if (state.toggles['net_reset_tcpip']) s += `\necho [*] Reseteando TCP/IP...\nnetsh int ip reset >nul\necho [OK] TCP/IP reseteado.\n`;
    if (state.toggles['net_disable_nagle']) s += `\necho [*] Desactivando Nagle...\nreg add "HKLM\\SOFTWARE\\Microsoft\\MSMQ\\Parameters" /v TCPNoDelay /t REG_DWORD /d 1 /f >nul\necho [OK] Nagle desactivado.\n`;
    if (state.toggles['net_qos_disable']) s += `\necho [*] Liberando ancho de banda QoS...\nreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Psched" /v NonBestEffortLimit /t REG_DWORD /d 0 /f >nul\necho [OK] QoS al 0%%.\n`;
    if (state.toggles['net_disable_autotuning']) s += `\necho [*] Desactivando Auto-Tuning...\nnetsh int tcp set global autotuninglevel=disabled >nul\necho [OK] Auto-Tuning desactivado.\n`;
    const dnsMap = { google: ['8.8.8.8','8.8.4.4'], cloudflare: ['1.1.1.1','1.0.0.1'], quad9: ['9.9.9.9','149.112.112.112'], opendns: ['208.67.222.222','208.67.220.220'] };
    const dns = state.selects['net_dns_provider'] || 'cloudflare';
    const adapter = state.selects['net_adapter'] === 'ethernet' ? 'Ethernet' : 'Wi-Fi';
    if (dns !== 'default') {
        const d = dnsMap[dns];
        s += `\necho [*] Configurando DNS ${dns}...\nnetsh interface ip set dns "${adapter}" static ${d[0]} primary >nul\nnetsh interface ip add dns "${adapter}" ${d[1]} index=2 >nul\necho [OK] DNS configurado: ${d[0]} / ${d[1]}.\n`;
    }

    // Power
    if (state.toggles['pwr_high_perf']) s += `\necho [*] Activando plan de alto rendimiento...\npowercfg /setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c >nul 2>&1\necho [OK] Plan alto rendimiento activado.\n`;
    if (state.toggles['pwr_hibernate_off']) s += `\necho [*] Desactivando hibernacion...\npowercfg /hibernate off >nul\necho [OK] Hibernacion desactivada.\n`;
    if (state.toggles['pwr_fast_startup']) s += `\necho [*] Desactivando inicio rapido...\nreg add "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Power" /v HiberbootEnabled /t REG_DWORD /d 0 /f >nul\necho [OK] Inicio rapido desactivado.\n`;
    if (state.toggles['pwr_usb_suspend_off']) s += `\necho [*] Desactivando USB Selective Suspend...\npowercfg /SETACVALUEINDEX SCHEME_CURRENT 2a737441-1930-4402-8d77-b2bebba308a3 48e6b7a6-50f5-4782-a5d4-53bb8f07e226 0 >nul\npowercfg /SETACTIVE SCHEME_CURRENT >nul\necho [OK] USB Suspend desactivado.\n`;

    // Privacy
    if (state.toggles['priv_telemetry']) s += `\necho [*] Desactivando telemetria...\nreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection" /v AllowTelemetry /t REG_DWORD /d 0 /f >nul\nsc config "DiagTrack" start= disabled >nul 2>&1\nsc stop "DiagTrack" >nul 2>&1\necho [OK] Telemetria desactivada.\n`;
    if (state.toggles['priv_cortana']) s += `\necho [*] Desactivando Cortana...\nreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Windows Search" /v AllowCortana /t REG_DWORD /d 0 /f >nul\necho [OK] Cortana desactivada.\n`;
    if (state.toggles['priv_activity_history']) s += `\necho [*] Desactivando historial de actividad...\nreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System" /v EnableActivityFeed /t REG_DWORD /d 0 /f >nul\nreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\System" /v PublishUserActivities /t REG_DWORD /d 0 /f >nul\necho [OK] Historial desactivado.\n`;
    if (state.toggles['priv_ad_id']) s += `\necho [*] Desactivando ID de publicidad...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\AdvertisingInfo" /v Enabled /t REG_DWORD /d 0 /f >nul\necho [OK] Ad ID desactivado.\n`;
    if (state.toggles['priv_location']) s += `\necho [*] Desactivando ubicacion...\nreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\LocationAndSensors" /v DisableLocation /t REG_DWORD /d 1 /f >nul\necho [OK] Ubicacion desactivada.\n`;
    if (state.toggles['priv_diagnostic_data']) s += `\necho [*] Datos de diagnostico minimos...\nreg add "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\DataCollection" /v AllowTelemetry /t REG_DWORD /d 0 /f >nul\necho [OK] Diagnostico al minimo.\n`;
    if (state.toggles['priv_tailored_exp']) s += `\necho [*] Desactivando experiencias personalizadas...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Privacy" /v TailoredExperiencesWithDiagnosticDataEnabled /t REG_DWORD /d 0 /f >nul\necho [OK] Experiencias personalizadas desactivadas.\n`;
    if (state.toggles['priv_feedback']) s += `\necho [*] Desactivando feedback...\nreg add "HKCU\\Software\\Microsoft\\Siuf\\Rules" /v NumberOfSIUFInPeriod /t REG_DWORD /d 0 /f >nul\necho [OK] Feedback desactivado.\n`;
    if (state.toggles['priv_start_suggestions']) s += `\necho [*] Desactivando sugerencias en Inicio...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\ContentDeliveryManager" /v SubscribedContent-338388Enabled /t REG_DWORD /d 0 /f >nul\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\ContentDeliveryManager" /v SystemPaneSuggestionsEnabled /t REG_DWORD /d 0 /f >nul\necho [OK] Sugerencias desactivadas.\n`;
    if (state.toggles['priv_lock_screen_tips']) s += `\necho [*] Desactivando tips en lock screen...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\ContentDeliveryManager" /v RotatingLockScreenOverlayEnabled /t REG_DWORD /d 0 /f >nul\necho [OK] Tips de lock screen desactivados.\n`;

    // Taskbar
    if (state.toggles['tb_hide_search']) s += `\necho [*] Ocultando busqueda de barra de tareas...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Search" /v SearchboxTaskbarMode /t REG_DWORD /d 0 /f >nul\necho [OK] Busqueda ocultada.\n`;
    if (state.toggles['tb_hide_task_view']) s += `\necho [*] Ocultando Vista de tareas...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced" /v ShowTaskViewButton /t REG_DWORD /d 0 /f >nul\necho [OK] Vista de tareas ocultada.\n`;
    if (state.toggles['tb_hide_widgets']) s += `\necho [*] Ocultando Widgets...\nreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Dsh" /v AllowNewsAndInterests /t REG_DWORD /d 0 /f >nul\necho [OK] Widgets ocultados.\n`;
    if (state.toggles['tb_hide_chat']) s += `\necho [*] Ocultando Chat...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced" /v TaskbarMn /t REG_DWORD /d 0 /f >nul\necho [OK] Chat ocultado.\n`;
    if (state.toggles['tb_hide_copilot']) s += `\necho [*] Ocultando Copilot...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced" /v ShowCopilotButton /t REG_DWORD /d 0 /f >nul\necho [OK] Copilot ocultado.\n`;
    const tbAlign = state.selects['tb_alignment'];
    if (tbAlign === 'left') s += `\necho [*] Alineando iconos a la izquierda...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced" /v TaskbarAl /t REG_DWORD /d 0 /f >nul\necho [OK] Iconos alineados a la izquierda.\n`;

    // Explorer
    if (state.toggles['exp_show_extensions']) s += `\necho [*] Mostrando extensiones de archivo...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced" /v HideFileExt /t REG_DWORD /d 0 /f >nul\necho [OK] Extensiones visibles.\n`;
    if (state.toggles['exp_show_hidden']) s += `\necho [*] Mostrando archivos ocultos...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced" /v Hidden /t REG_DWORD /d 1 /f >nul\necho [OK] Archivos ocultos visibles.\n`;
    if (state.toggles['exp_open_this_pc']) s += `\necho [*] Abriendo explorador en Este equipo...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced" /v LaunchTo /t REG_DWORD /d 1 /f >nul\necho [OK] Explorador abre en Este equipo.\n`;
    if (state.toggles['exp_classic_menu']) s += `\necho [*] Activando menu contextual clasico (Win11)...\nreg add "HKCU\\Software\\Classes\\CLSID\\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\\InprocServer32" /f /ve >nul 2>&1\necho [OK] Menu clasico activado.\n`;
    if (state.toggles['exp_disable_recent']) s += `\necho [*] Desactivando archivos recientes...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer" /v ShowRecent /t REG_DWORD /d 0 /f >nul\necho [OK] Recientes desactivados.\n`;
    if (state.toggles['exp_disable_frequent']) s += `\necho [*] Desactivando carpetas frecuentes...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer" /v ShowFrequent /t REG_DWORD /d 0 /f >nul\necho [OK] Frecuentes desactivados.\n`;

    // Visual
    if (state.toggles['vis_dark_mode']) s += `\necho [*] Activando modo oscuro del sistema...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize" /v SystemUsesLightTheme /t REG_DWORD /d 0 /f >nul\necho [OK] Modo oscuro del sistema activado.\n`;
    if (state.toggles['vis_dark_apps']) s += `\necho [*] Activando modo oscuro en apps...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize" /v AppsUseLightTheme /t REG_DWORD /d 0 /f >nul\necho [OK] Modo oscuro en apps activado.\n`;
    if (state.toggles['vis_show_extensions']) s += `\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced" /v HideFileExt /t REG_DWORD /d 0 /f >nul\n`;
    if (state.toggles['vis_enhance_pointer'] === false && state.toggles['vis_enhance_pointer'] !== undefined) s += `\necho [*] Desactivando aceleracion del mouse...\nreg add "HKCU\\Control Panel\\Mouse" /v MouseSpeed /t REG_SZ /d "0" /f >nul\nreg add "HKCU\\Control Panel\\Mouse" /v MouseThreshold1 /t REG_SZ /d "0" /f >nul\nreg add "HKCU\\Control Panel\\Mouse" /v MouseThreshold2 /t REG_SZ /d "0" /f >nul\necho [OK] Aceleracion del mouse desactivada.\n`;

    // Services
    if (state.toggles['svc_diagtrack']) s += `\nsc config "DiagTrack" start= disabled >nul 2>&1 & sc stop "DiagTrack" >nul 2>&1\n`;
    if (state.toggles['svc_dmwappush']) s += `\nsc config "dmwappushservice" start= disabled >nul 2>&1 & sc stop "dmwappushservice" >nul 2>&1\n`;
    if (state.toggles['svc_xbox']) s += `\necho [*] Desactivando servicios Xbox...\nsc config "XblAuthManager" start= disabled >nul 2>&1\nsc config "XblGameSave" start= disabled >nul 2>&1\nsc config "XboxGipSvc" start= disabled >nul 2>&1\nsc config "XboxNetApiSvc" start= disabled >nul 2>&1\necho [OK] Servicios Xbox desactivados.\n`;
    if (state.toggles['svc_maps']) s += `\nsc config "MapsBroker" start= disabled >nul 2>&1 & sc stop "MapsBroker" >nul 2>&1\n`;
    if (state.toggles['svc_fax']) s += `\nsc config "Fax" start= disabled >nul 2>&1\n`;
    if (state.toggles['svc_print_spooler']) s += `\nsc config "Spooler" start= disabled >nul 2>&1 & sc stop "Spooler" >nul 2>&1\n`;
    if (state.toggles['svc_remote_registry']) s += `\nsc config "RemoteRegistry" start= disabled >nul 2>&1 & sc stop "RemoteRegistry" >nul 2>&1\n`;

    // Gaming
    if (state.toggles['game_mode']) s += `\necho [*] Activando Game Mode...\nreg add "HKCU\\Software\\Microsoft\\GameBar" /v AllowAutoGameMode /t REG_DWORD /d 1 /f >nul\necho [OK] Game Mode activado.\n`;
    if (state.toggles['game_dvr_off']) s += `\necho [*] Desactivando Game DVR...\nreg add "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\GameDVR" /v AppCaptureEnabled /t REG_DWORD /d 0 /f >nul\nreg add "HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\GameDVR" /v AllowGameDVR /t REG_DWORD /d 0 /f >nul\necho [OK] Game DVR desactivado.\n`;
    if (state.toggles['game_fullscreen_opt']) s += `\necho [*] Desactivando optimizacion pantalla completa...\nreg add "HKCU\\System\\GameConfigStore" /v GameDVR_FSEBehaviorMode /t REG_DWORD /d 2 /f >nul\nreg add "HKCU\\System\\GameConfigStore" /v GameDVR_FSEBehavior /t REG_DWORD /d 2 /f >nul\necho [OK] Optimizacion fullscreen desactivada.\n`;
    if (state.toggles['game_mouse_accel']) s += `\necho [*] Desactivando aceleracion del mouse (gaming)...\nreg add "HKCU\\Control Panel\\Mouse" /v MouseSpeed /t REG_SZ /d "0" /f >nul\nreg add "HKCU\\Control Panel\\Mouse" /v MouseThreshold1 /t REG_SZ /d "0" /f >nul\nreg add "HKCU\\Control Panel\\Mouse" /v MouseThreshold2 /t REG_SZ /d "0" /f >nul\necho [OK] Aceleracion del mouse desactivada.\n`;

    // Maintenance
    if (state.toggles['maint_dism']) s += `\necho [*] Ejecutando DISM...\nDISM /Online /Cleanup-Image /RestoreHealth\necho [OK] DISM completado.\n`;
    if (state.toggles['maint_sfc']) s += `\necho [*] Ejecutando SFC...\nsfc /scannow\necho [OK] SFC completado.\n`;
    if (state.toggles['maint_defrag']) s += `\necho [*] Optimizando disco...\ndefrag C: /O\necho [OK] Disco optimizado.\n`;

    s += `
echo.
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.
echo   ‚úÖ OPTIMIZACION COMPLETADA ‚Äî LenovoTuner Pro
echo   Dispositivo: Lenovo IdeaPad i3
echo   Fecha: %date%
echo.
echo   Reinicia tu laptop para aplicar todos los cambios.
echo.
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.
set /p r="¬øReiniciar ahora? (S/N): "
if /i "%r%"=="S" (shutdown /r /t 10 /c "Reiniciando ‚Äî LenovoTuner Pro")
pause
`;
    return s;
}

function generateReg() {
    let s = `Windows Registry Editor Version 5.00

; ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
; LenovoTuner Pro ‚Äî Archivo de Registro
; Lenovo IdeaPad ‚Äî Intel Core i3
; ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

`;
    if (state.toggles['perf_visual'] || state.toggles['vis_disable_anim']) s += `; Optimizar efectos visuales\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\VisualEffects]\n"VisualFXSetting"=dword:00000002\n\n[HKEY_CURRENT_USER\\Control Panel\\Desktop\\WindowMetrics]\n"MinAnimate"="0"\n\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced]\n"TaskbarAnimations"=dword:00000000\n\n`;
    if (state.toggles['perf_transparency'] || state.toggles['vis_disable_transparency']) s += `; Desactivar transparencias\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize]\n"EnableTransparency"=dword:00000000\n\n`;
    if (state.toggles['perf_menu_delay']) s += `; Reducir delay de menus\n[HKEY_CURRENT_USER\\Control Panel\\Desktop]\n"MenuShowDelay"="${state.sliders['perf_menu_speed'] || 50}"\n\n`;
    if (state.toggles['vis_dark_mode']) s += `; Modo oscuro sistema\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize]\n"SystemUsesLightTheme"=dword:00000000\n\n`;
    if (state.toggles['vis_dark_apps']) s += `; Modo oscuro apps\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Themes\\Personalize]\n"AppsUseLightTheme"=dword:00000000\n\n`;
    if (state.toggles['priv_telemetry']) s += `; Desactivar telemetria\n[HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection]\n"AllowTelemetry"=dword:00000000\n\n`;
    if (state.toggles['priv_cortana']) s += `; Desactivar Cortana\n[HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\Windows Search]\n"AllowCortana"=dword:00000000\n\n`;
    if (state.toggles['priv_ad_id']) s += `; Desactivar Ad ID\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\AdvertisingInfo]\n"Enabled"=dword:00000000\n\n`;
    if (state.toggles['tb_hide_search']) s += `; Ocultar busqueda\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Search]\n"SearchboxTaskbarMode"=dword:00000000\n\n`;
    if (state.toggles['tb_hide_task_view']) s += `; Ocultar vista de tareas\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced]\n"ShowTaskViewButton"=dword:00000000\n\n`;
    if (state.toggles['exp_show_extensions']) s += `; Mostrar extensiones\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced]\n"HideFileExt"=dword:00000000\n\n`;
    if (state.toggles['exp_open_this_pc']) s += `; Abrir en Este equipo\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced]\n"LaunchTo"=dword:00000001\n\n`;
    if (state.toggles['exp_classic_menu']) s += `; Menu contextual clasico Win11\n[HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\\InprocServer32]\n@=""\n\n`;
    if (state.toggles['game_dvr_off']) s += `; Desactivar Game DVR\n[HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\GameDVR]\n"AppCaptureEnabled"=dword:00000000\n\n[HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Windows\\GameDVR]\n"AllowGameDVR"=dword:00000000\n\n`;
    return s;
}

function generatePS1() {
    let s = `# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# LenovoTuner Pro ‚Äî PowerShell Script
# Lenovo IdeaPad ‚Äî Intel Core i3
# Ejecutar como Administrador
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Verificar Admin
if (-NOT ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Host "[ERROR] Ejecuta PowerShell como Administrador" -ForegroundColor Red
    exit
}

Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Cyan
Write-Host "  LenovoTuner Pro ‚Äî Optimizador Integral" -ForegroundColor Cyan
Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Cyan
Write-Host ""

`;
    if (state.toggles['maint_restore_point']) s += `Write-Host "[*] Creando punto de restauracion..." -ForegroundColor Yellow\nCheckpoint-Computer -Description "LenovoTuner_Backup" -RestorePointType "MODIFY_SETTINGS" -ErrorAction SilentlyContinue\nWrite-Host "[OK] Punto de restauracion creado." -ForegroundColor Green\n\n`;
    if (state.toggles['clean_bloatware']) s += `# Remover Bloatware\nWrite-Host "[*] Removiendo bloatware..." -ForegroundColor Yellow\n$bloatware = @("*3dbuilder*","*getstarted*","*solitairecollection*","*bingfinance*","*bingnews*","*bingsports*","*bingweather*","*zunevideo*","*zunemusic*","*xboxapp*","*officehub*","*skypeapp*","*windowsmaps*","*clipchamp*","*todos*","*feedback*")\nforeach ($app in $bloatware) {\n    Get-AppxPackage $app | Remove-AppxPackage -ErrorAction SilentlyContinue\n}\nWrite-Host "[OK] Bloatware removido." -ForegroundColor Green\n\n`;
    if (state.toggles['priv_telemetry']) s += `# Desactivar telemetria\nWrite-Host "[*] Desactivando telemetria..." -ForegroundColor Yellow\nSet-ItemProperty -Path "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection" -Name "AllowTelemetry" -Value 0 -Type DWord -Force\nStop-Service "DiagTrack" -Force -ErrorAction SilentlyContinue\nSet-Service "DiagTrack" -StartupType Disabled\nWrite-Host "[OK] Telemetria desactivada." -ForegroundColor Green\n\n`;
    if (state.toggles['perf_sysmain']) s += `# Desactivar SysMain\nWrite-Host "[*] Desactivando SysMain..." -ForegroundColor Yellow\nStop-Service "SysMain" -Force -ErrorAction SilentlyContinue\nSet-Service "SysMain" -StartupType Disabled\nWrite-Host "[OK] SysMain desactivado." -ForegroundColor Green\n\n`;
    if (state.toggles['clean_temp']) s += `# Limpiar temporales\nWrite-Host "[*] Limpiando archivos temporales..." -ForegroundColor Yellow\nRemove-Item -Path "$env:TEMP\\*" -Recurse -Force -ErrorAction SilentlyContinue\nRemove-Item -Path "C:\\Windows\\Temp\\*" -Recurse -Force -ErrorAction SilentlyContinue\nWrite-Host "[OK] Temporales limpiados." -ForegroundColor Green\n\n`;
    s += `\nWrite-Host ""\nWrite-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Green\nWrite-Host "  Optimizacion completada ‚Äî LenovoTuner Pro" -ForegroundColor Green\nWrite-Host "  Reinicia para aplicar todos los cambios." -ForegroundColor Yellow\nWrite-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Green\nRead-Host "Presiona Enter para salir"\n`;
    return s;
}

function generateAHK() {
    let s = `; ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
; LenovoTuner Pro ‚Äî AutoHotkey Keybinds
; Requiere: AutoHotkey v2.0+
; https://www.autohotkey.com/
; ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

#Requires AutoHotkey v2.0
#SingleInstance Force

; ‚îÄ‚îÄ‚îÄ Atajos del Sistema ‚îÄ‚îÄ‚îÄ
`;
    const ahkMap = {
        'kb_screenshot': { action: 'Send "{PrintScreen}"', desc: 'Captura de pantalla' },
        'kb_task_manager': { action: 'Run "taskmgr.exe"', desc: 'Abrir Task Manager' },
        'kb_run_dialog': { action: 'Send "#r"', desc: 'Di√°logo Ejecutar' },
        'kb_file_explorer': { action: 'Run "explorer.exe"', desc: 'Explorador de archivos' },
        'kb_cmd_admin': { action: 'Run "*RunAs cmd.exe"', desc: 'CMD como Admin' },
        'kb_desktop': { action: 'Send "#d"', desc: 'Mostrar escritorio' },
        'kb_vol_up': { action: 'Send "{Volume_Up}"', desc: 'Subir volumen' },
        'kb_vol_down': { action: 'Send "{Volume_Down}"', desc: 'Bajar volumen' },
        'kb_vol_mute': { action: 'Send "{Volume_Mute}"', desc: 'Silenciar' },
        'kb_play_pause': { action: 'Send "{Media_Play_Pause}"', desc: 'Play/Pausa' },
        'kb_custom1': { action: 'Run "calc.exe"', desc: 'Abrir Calculadora' },
        'kb_custom2': { action: 'Run "notepad.exe"', desc: 'Abrir Bloc de notas' },
    };

    Object.entries(state.keybinds).forEach(([id, combo]) => {
        const info = ahkMap[id];
        if (!info) return;
        let ahkCombo = combo.replace(/Ctrl/g, '^').replace(/Alt/g, '!').replace(/Shift/g, '+').replace(/Win/g, '#').replace(/ \+ /g, '').replace(/Escape/g, 'Escape').replace(/Space/g, 'Space');
        // Handle single letter keys
        ahkCombo = ahkCombo.replace(/([A-Z])$/, (m) => m.toLowerCase());
        s += `; ${info.desc}\n${ahkCombo}:: {\n    ${info.action}\n}\n\n`;
    });

    s += `; ‚îÄ‚îÄ‚îÄ Notificaci√≥n de inicio ‚îÄ‚îÄ‚îÄ\nToolTip "LenovoTuner Keybinds activos!"\nSetTimer () => ToolTip(), -2000\n`;
    return s;
}

// ==========================================
// EXPORT UI
// ==========================================
function generateAndShow(type) {
    let code, filename;
    switch(type) {
        case 'bat': code = generateBat(); filename = 'LenovoTuner_optimizar.bat'; break;
        case 'reg': code = generateReg(); filename = 'LenovoTuner_registro.reg'; break;
        case 'ps1': code = generatePS1(); filename = 'LenovoTuner_powershell.ps1'; break;
        case 'ahk': code = generateAHK(); filename = 'LenovoTuner_keybinds.ahk'; break;
        case 'all': code = generateBat(); filename = 'LenovoTuner_TODO.bat'; break;
    }
    document.getElementById('modalCode').textContent = code;
    document.getElementById('modalFileName').textContent = filename;
    document.getElementById('exportModal').classList.remove('hidden');
    document.getElementById('exportModal')._filename = filename;
    document.getElementById('exportModal')._code = code;
}

function closeExportModal() {
    document.getElementById('exportModal').classList.add('hidden');
}

function copyModalCode() {
    const code = document.getElementById('exportModal')._code;
    navigator.clipboard.writeText(code).then(() => {
        const btn = document.getElementById('modalCopyBtn');
        btn.textContent = '‚úÖ Copiado!';
        setTimeout(() => btn.textContent = 'üìã Copiar', 2000);
    });
}

function downloadModalCode() {
    const code = document.getElementById('exportModal')._code;
    const filename = document.getElementById('exportModal')._filename;
    const blob = new Blob([code], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename;
    document.body.appendChild(a); a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// ==========================================
// PROFILES
// ==========================================
function saveProfile() {
    const name = document.getElementById('profileName')?.value?.trim();
    if (!name) { alert('Escribe un nombre para el perfil'); return; }
    const profiles = JSON.parse(localStorage.getItem('lenovotuner_profiles') || '{}');
    profiles[name] = { toggles: {...state.toggles}, sliders: {...state.sliders}, selects: {...state.selects}, keybinds: {...state.keybinds}, colors: {...state.colors}, date: new Date().toLocaleString() };
    localStorage.setItem('lenovotuner_profiles', JSON.stringify(profiles));
    alert('‚úÖ Perfil "' + name + '" guardado!');
    renderSection('profiles');
}

function loadProfile(name) {
    const profiles = JSON.parse(localStorage.getItem('lenovotuner_profiles') || '{}');
    if (profiles[name]) {
        Object.assign(state.toggles, profiles[name].toggles || {});
        Object.assign(state.sliders, profiles[name].sliders || {});
        Object.assign(state.selects, profiles[name].selects || {});
        Object.assign(state.keybinds, profiles[name].keybinds || {});
        Object.assign(state.colors, profiles[name].colors || {});
        alert('‚úÖ Perfil "' + name + '" cargado!');
        renderSection('profiles');
    }
}

function deleteProfile(name) {
    if (!confirm('¬øEliminar perfil "' + name + '"?')) return;
    const profiles = JSON.parse(localStorage.getItem('lenovotuner_profiles') || '{}');
    delete profiles[name];
    localStorage.setItem('lenovotuner_profiles', JSON.stringify(profiles));
    renderSection('profiles');
}

function exportConfig() {
    const data = { toggles: state.toggles, sliders: state.sliders, selects: state.selects, keybinds: state.keybinds, colors: state.colors };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'lenovotuner_config.json';
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function importConfig(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            if (data.toggles) Object.assign(state.toggles, data.toggles);
            if (data.sliders) Object.assign(state.sliders, data.sliders);
            if (data.selects) Object.assign(state.selects, data.selects);
            if (data.keybinds) Object.assign(state.keybinds, data.keybinds);
            if (data.colors) Object.assign(state.colors, data.colors);
            alert('‚úÖ Configuraci√≥n importada!');
            renderSection(state.currentSection);
        } catch(e) { alert('‚ùå Error al leer el archivo'); }
    };
    reader.readAsText(file);
}

// ==========================================
// INIT
// ==========================================
renderSection('dashboard');
</script>
</body>
</html>
